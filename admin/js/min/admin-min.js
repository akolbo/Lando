/*
Title:				Admin Panel JavaScript
Author:				Sam Rayner - http://samrayner.com
Created:			2011-09-16
*/var PageNav={sortableTree:function(a){var b={};for(var c=0;c<a.length;c++){var d=a[c];b[d]=PageNav.sortableTree($("#"+d+" > .sortable").sortable("toArray"));$("#"+d+" > * > input:checked").length||(b[d]._hidden=!0)}return b},removePropPrefix:function(a,b){var c={};for(var d in a){var e=new RegExp("^"+b,"i"),f=d.replace(e,"");window.console.log(f);typeof a[d]!="object"||$.isEmptyObject(a[d])?c[f]=a[d]:c[f]=PageNav.removePropPrefix(a[d],b)}return c},updateOrder:function(){var a=$("#page-list > ol").sortable("toArray"),b=PageNav.sortableTree(a),c=PageNav.removePropPrefix(b,"page_");$("#page_order").val(JSON.stringify(c))},updateVisibility:function(a){var b=a.target.checked;$(this).closest("li").find("* * input:checkbox").each(function(){if(!b)$(this).attr("disabled",!0);else{var a=$(this).closest("li").parentsUntil($("#page-list"),"li"),c=a.children("div").children("input:not([checked])").length;c||$(this).removeAttr("disabled")}});PageNav.updateOrder()},labelTap:function(){var a=$("#".$(this).attr("for")),b=a.checked;b?a.removeAttr("checked"):a.attr("checked",1)},init:function(){$("#page-list input:checkbox").change(PageNav.updateVisibility);$("#page-list label").click(PageNav.labelTap);$("#page-list > ol").disableSelection();$(".sortable").sortable({update:PageNav.updateOrder});$(".sortable input:checkbox").change()}},Tooltips={toggle:function(a){var b=$(a);b.toggleClass("collapsed")},init:function(){$("#pretty_urls").change(function(){Tooltips.toggle("#htaccess")})}},Recache={types:["collections","snippets","pages","posts","drafts"],done:function(){$("#recache-button").removeClass("active").removeAttr("style").addClass("done").attr("data-icon","2").html("Caching complete");$("#cleanup-button").length&&Recache.nextStep()},nextStep:function(a){a&&a.preventDefault();$("#cache, #cleanup").toggleClass("disabled");CleanUp.init();Recache.disable()},updateProgress:function(a){var b=Recache.types.indexOf(a),c=(b+1)*100/Recache.types.length;$("#recache-button").html("Caching "+a+"&hellip;");var d=$("#recache-button").outerWidth();$("#recache-button").css("background-position-x",Math.round(d*c/100)+"px")},process:function(a){var b=Recache.types.indexOf(a);b>=0&&Recache.updateProgress(a);var c=$.ajax({url:"../admin/update/index.php",data:{type:a},complete:function(){b>=0&&(b+1===Recache.types.length?Recache.done():Recache.process(Recache.types[b+1]))}})},block:function(a){var b=$("#recache-button");b.parent().addClass("disabled");b.html("Save changes before caching").attr("data-icon","d");Recache.disable()},click:function(a){a.preventDefault();$(this).removeClass("done").addClass("active").attr("data-icon","0");Recache.process(Recache.types[0])},init:function(){$("#host_root").change(Recache.block);$("#recache-button").click(Recache.click);$("#cache .skip").click(Recache.nextStep)},disable:function(){$("#recache-button, #cache .skip").off("click")}},FormCheck={required:function(a){var b=$(this).find("input[required]").filter(function(){return $(this).val().trim()===""});$.each(b,function(){$(this).addClass("highlight")});if(b.length>0){b[0].focus();a.preventDefault();return!1}},verifyPass:function(a){if($("#admin_password").val()!==$("#confirm_pass").val()){window.alert("The passwords you entered don't match, please type them again.");$("#admin_password").val("").addClass("highlight").focus();$("#confirm_pass").val("").addClass("highlight");a.preventDefault();return!1}},init:function(){$("form").submit(FormCheck.required);$("form").submit(FormCheck.verifyPass)}};$(function(){Tooltips.init();FormCheck.init();$("#page-list").length&&PageNav.init();$("section:not(.disabled) #recache-button").length&&Recache.init()});